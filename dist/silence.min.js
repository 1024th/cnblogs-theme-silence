"use strict";var _createClass=function(){function n(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,a,t){return a&&n(e.prototype,a),t&&n(e,t),e}}();function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}!function(u){u.extend({silence:function(e){var a=new t;a.init(e)}});var t=function(){function e(){_classCallCheck(this,e),this.defaluts={catalog:{enable:!1,move:!0,index:!0,level1:"h2",level2:"h3",level3:"h4"},signature:{enable:!1,author:currentBlogApp||"--",home:"https://www.cnblogs.com",license:"署名 4.0 国际",link:"https://creativecommons.org/licenses/by/4.0"},reward:{enable:!1,title:null,wechat:null,alipay:null}}}return _createClass(e,[{key:"init",value:function(e){e&&u.extend(!0,this.defaluts,e),this.buildNavHoverEle(),this.buildMobileMenu(),this.buildCopyright(),this.isPostDetail&&(this.goIntoReadingMode(),this.buildPostCatalog(),this.buildPostSignature(),this.buildPostReward(),this.buildPostCommentAvatar())}},{key:"showMessage",value:function(e){u(".esa-layer").length||u("body").prepend('<div class="esa-layer"><span class="esa-layer-content"></span></div>'),u(".esa-layer-content").html(e),u(".esa-layer").fadeIn(250),setTimeout(function(){u(".esa-layer").fadeOut(500,function(){u(".esa-layer-content").empty()})},2500)}},{key:"goIntoReadingMode",value:function(){var e=u(window),a=this;u(a.cnblogs.sideBar).fadeOut(1e3,function(){u(a.cnblogs.forFlow).css({margin:"0 auto",maxWidth:"960px"})}),e.scroll(function(e){150<this.scrollY?u(a.cnblogs.header).slideUp():u(a.cnblogs.header).slideDown()})}},{key:"buildNavHoverEle",value:function(){var e=u(this.cnblogs.navList).find("li");u.each(e,function(e,a){u(a).append("<i></i>")})}},{key:"buildMobileMenu",value:function(){var e=this;u("body").prepend('<div class="esa-mobile-menu"></div>'),u(".esa-mobile-menu").on("click",function(){u(e.cnblogs.navigator).fadeToggle(200)})}},{key:"buildCopyright",value:function(){u(this.cnblogs.footer).append('<div>            Powered By             <a href="https://www.cnblogs.com" target="_blank">Cnblogs</a> |             <a href="https://github.com/esofar/cnblogs-theme-silence" target="_blank">Silence</a>             Theme By             <a href="https://www.cnblogs.com/esofar" target="_blank">Esofar</a></div>')}},{key:"buildPostSignature",value:function(){var e=this.defaluts.signature;if(e.enable){var a=u(this.cnblogs.postTitle).attr("href"),t='<div class="esa-post-signature">                                 <p>作者：<a href="'+e.home+'">'+e.author+'</a></p>                                 <p>出处：<a href="'+a+'">'+a+'</a></p>                                 <p>本站使用「<a href="'+(e.link||"#")+'"  target="_blank">'+e.license+"</a>」创作共享协议，转载请在文章明显位置注明作者及出处。</p>                                </div>";u(this.cnblogs.mySignature).html(t).show()}}},{key:"buildPostCommentAvatar",value:function(){var i=this,e=function(){u(i.cnblogs.postCommentBody).before("<div class='esa-comment-avatar'><a target='_blank'><img /></a></div>");for(var e=u(i.cnblogs.feedbackContent),a=0;a<e.length;a++){var t="https://pic.cnblogs.com/face/sample_face.gif",n=u(e[a]).find("span:last")[0];n&&(t=u(n).html().replace("http://","https://")),u(e[a]).find(".esa-comment-avatar img").attr("src",t);var s=u(e[a]).parent().find(".comment_date").next().attr("href");u(e[a]).find(".esa-comment-avatar a").attr("href",s)}};if(u(i.cnblogs.postCommentBody).length)e();else var a=1,t=setInterval(function(){u(i.cnblogs.postCommentBody).length&&(clearInterval(t),e()),5==a&&clearInterval(t),a++},1e3)}},{key:"buildPostReward",value:function(){var e=this.defaluts.reward;if(e.enable){if(!e.wechat&&!e.alipay)throw new Error("Reward module, both `wechat` and `alipay` are null.");var a='<div class="esa-reward">                         <div class="esa-reward-close">+</div>                         <h2>"'+(e.title||"")+'"</h2>                         <div class="esa-reward-container">';e.wechat&&(a+='<div class="wechat">                                         <img src="'+e.wechat+'" alt="微信支付">                                     </div>'),e.alipay&&(a+='<div class="alipay">                                         <img src="'+e.alipay+'" alt="支付宝支付">                                     </div>'),a+="</div></div>",u("body").append(a),u(".esa-reward-close").on("click",function(){u(".esa-reward").fadeOut()});var t=function(){u("#div_digg").prepend('<div class="reward"><span class="rewardnum" id="reward_count"></span></div>'),u("#div_digg .reward").on("click",function(){u(".esa-reward").fadeIn()})};if(u("#div_digg").length)t();else var n=setInterval(function(){u("#div_digg").length&&(clearInterval(n),t())},500)}else u("#div_digg").width(200)}},{key:"buildPostCatalog",value:function(){var i=this.defaluts.catalog;if(i.enable){var e=[i.level1,i.level2,i.level3],a=u(this.cnblogs.postBody).find(e.join(","));if(!a.length)return!1;var t=u('<div class="esa-catalog">                                     <div class="esa-catalog-tab"><h2>目录</h2></div>                                     <div class="esa-catalog-contents">                                         <div class="esa-catalog-title"><h2>目录</h2></div>                                         <a class="esa-catalog-close">X</a>                                     </div>                                 </div>'),o=0,l=0,r=0,c="<ul>";u.each(a,function(e,a){var t=u(a)[0].tagName.toLowerCase(),n="",s=u(a).text();if(i.index)t===i.level1?(r=l=0,n=++o+".&nbsp;"):t===i.level2?(r=0,n="&nbsp;&nbsp;"+o+"."+ ++l+".&nbsp;"):t===i.level3&&(n="&nbsp;&nbsp;&nbsp;&nbsp;"+o+"."+l+"."+ ++r+".&nbsp;");else switch(t){case i.level1:s=s;break;case i.level2:s="&nbsp;&nbsp;"+s;break;case i.level3:s="&nbsp;&nbsp;&nbsp;&nbsp;"+s}c+='<li class="li_'+t+'" title="'+s+'"><i id="esa_index_'+e+'"></i><a class="esa-anchor-link">'+(n+s)+"</a></li>",u(a).attr("id","esa_index_"+e)}),c+="</ul>",t.find(".esa-catalog-contents").append(c),t.appendTo("body");if(u(".esa-anchor-link").on("click",function(){var e=u(this).prev("i").attr("id"),a=u("#"+e).offset().top-70;u("html, body").animate({scrollTop:a},300)}),u(".esa-catalog-tab").on("click",function(){u(this).hide(),u(".esa-catalog-contents").show()}),u(".esa-catalog-close").on("click",function(){u(".esa-catalog-contents").hide(),u(".esa-catalog-tab").show()}),i.move){var d={start:!1,pois:[0,0]};u(".esa-catalog-title").on("mousedown",function(e){e.preventDefault(),d.start=!0;var a=u(".esa-catalog").position(),t=e.clientX-parseFloat(a.left),n=e.clientY-parseFloat(a.top);d.pois=[t,n]}),u(document).on("mousemove",function(e){if(d.start){var a=e.clientX-d.pois[0],t=e.clientY-d.pois[1],n="fixed"===u(".esa-catalog").css("position");e.preventDefault(),d.stX=n?0:u(window).scrollLeft(),d.stY=n?0:u(window).scrollTop();var s=u(window).width()-u(".esa-catalog").outerWidth()+d.stX,i=u(window).height()-u(".esa-catalog").outerHeight()+d.stY;a<d.stX&&(a=d.stX),s<a&&(a=s),t<d.stY&&(t=d.stY),i<t&&(t=i),u(".esa-catalog").css({left:a,top:t,right:"auto"})}}).on("mouseup",function(e){d.start&&(d.start=!1)})}}}},{key:"version",get:function(){return"1.0.3"}},{key:"cnblogs",get:function(){return{header:"#header",navigator:"#navigator",navList:"#navList",sideBar:"#sideBar",forFlow:".forFlow",postTitle:"#cb_post_title_url",postDetail:"#post_detail",postBody:"#cnblogs_post_body",postCommentBody:".blog_comment_body",feedbackContent:".feedbackCon",mySignature:"#MySignature",footer:"#footer"}}},{key:"isPostDetail",get:function(){return 0<u(this.cnblogs.postDetail).length}}]),e}()}(jQuery);