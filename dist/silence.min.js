"use strict";var _createClass=function(){function n(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,a,t){return a&&n(e.prototype,a),t&&n(e,t),e}}();function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}!function(v){v.extend({silence:function(e){var a=new t;a.init(e)}});var t=function(){function e(){_classCallCheck(this,e),this.defaluts={catalog:{enable:!1,move:!0,index:!0,level1:"h2",level2:"h3",level3:"h4"},signature:{enable:!1,author:currentBlogApp||"--",home:"https://www.cnblogs.com",license:"署名 4.0 国际",link:"https://creativecommons.org/licenses/by/4.0"},reward:{enable:!1,title:null,wechat:null,alipay:null}}}return _createClass(e,[{key:"init",value:function(e){e&&v.extend(!0,this.defaluts,e),this.buildNavHoverDom(),this.buildMobileMenu(),this.buildCopyright(),this.isPostDetail?(this.goIntoReadingMode(),this.buildPostCatalog(),this.buildPostSignature(),this.buildPostFavoriteBtn(),this.buildPostRewardBtn(),this.buildPostCommentAvatar()):this.goIntoNormalMode()}},{key:"showMessage",value:function(e){v(".esa-layer").length||v("body").prepend('<div class="esa-layer"><span class="esa-layer-content"></span></div>'),v(".esa-layer-content").html(e),v(".esa-layer").fadeIn(250),setTimeout(function(){v(".esa-layer").fadeOut(500,function(){v(".esa-layer-content").empty()})},2500)}},{key:"goIntoReadingMode",value:function(){var e=this,a=v(window);767<a.width()&&a.scroll(function(){150<this.scrollY?v(e.cnblogs.header).slideUp():v(e.cnblogs.header).slideDown()})}},{key:"goIntoNormalMode",value:function(){767<v(window).width()&&(v(this.cnblogs.forFlow).css({marginLeft:"22em"}),v(this.cnblogs.sideBar).fadeIn(700))}},{key:"buildNavHoverDom",value:function(){var e=v(this.cnblogs.navList).find("li");v.each(e,function(e,a){v(a).append("<i></i>")})}},{key:"buildMobileMenu",value:function(){var e=this;v("body").prepend('<div class="esa-mobile-menu"></div>'),v(".esa-mobile-menu").on("click",function(){v(e.cnblogs.navigator).fadeToggle(200)})}},{key:"buildCopyright",value:function(){v(this.cnblogs.footer).append('<div>            Powered By             <a href="https://www.cnblogs.com" target="_blank">Cnblogs</a> | Theme             <a href="https://github.com/esofar/cnblogs-theme-silence/releases" target="_blank">Silence '+this.version+"</a></div>")}},{key:"buildPostSignature",value:function(){var e=this.defaluts.signature;if(e.enable){var a=v(this.cnblogs.postTitle).attr("href"),t='<div class="esa-post-signature">                                 <p>作者：<a href="'+e.home+'">'+e.author+'</a></p>                                 <p>出处：<a href="'+a+'">'+a+'</a></p>                                 <p>本站使用「<a href="'+(e.link||"#")+'"  target="_blank">'+e.license+"</a>」创作共享协议，转载请在文章明显位置注明作者及出处。</p>                                </div>";v(this.cnblogs.mySignature).html(t).show()}}},{key:"buildPostCommentAvatar",value:function(){var i=this,e=function(){v(i.cnblogs.postCommentBody).before("<div class='esa-comment-avatar'><a target='_blank'><img /></a></div>");for(var e=v(i.cnblogs.feedbackContent),a=0;a<e.length;a++){var t="https://pic.cnblogs.com/face/sample_face.gif",n=v(e[a]).find("span:last")[0];n&&(t=v(n).html().replace("http://","https://")),v(e[a]).find(".esa-comment-avatar img").attr("src",t);var s=v(e[a]).parent().find(".comment_date").next().attr("href");v(e[a]).find(".esa-comment-avatar a").attr("href",s)}};if(v(i.cnblogs.postCommentBody).length)e();else var a=1,t=setInterval(function(){v(i.cnblogs.postCommentBody).length&&(clearInterval(t),e()),10==a&&clearInterval(t),a++},500)}},{key:"buildPostRewardBtn",value:function(){var e=this.defaluts.reward;if(e.enable){if(!e.wechat&&!e.alipay)throw new Error("Reward module, both `wechat` and `alipay` are null.");var a='<div class="esa-reward">                         <div class="esa-reward-close">+</div>                         <h2>"'+(e.title||"")+'"</h2>                         <div class="esa-reward-container">';e.wechat&&(a+='<div class="wechat">                                         <img src="'+e.wechat+'" alt="微信支付">                                     </div>'),e.alipay&&(a+='<div class="alipay">                                         <img src="'+e.alipay+'" alt="支付宝支付">                                     </div>'),a+="</div></div>",v("body").append(a),v(".esa-reward-close").on("click",function(){v(".esa-reward").fadeOut()});var t=function(){v("#div_digg").prepend('<div class="reward"><span class="rewardnum" id="reward_count"></span></div>'),v("#div_digg .reward").on("click",function(){v(".esa-reward").fadeIn()})};if(v("#div_digg").length)t();else var n=setInterval(function(){v("#div_digg").length&&(clearInterval(n),t())},200)}else v("#div_digg").width(300)}},{key:"buildPostFavoriteBtn",value:function(){var e=function(){v("#div_digg").prepend('<div class="favorite" onclick="AddToWz(cb_entryId);return false;"><span class="favoritenum" id="favorite_count"></span></div>')};if(v("#div_digg").length)e();else var a=setInterval(function(){v("#div_digg").length&&(clearInterval(a),e())},200)}},{key:"buildPostCatalog",value:function(){var i=this.defaluts.catalog;if(i.enable){var e=[i.level1,i.level2,i.level3],a=v(this.cnblogs.postBody).find(e.join(","));if(!a.length)return!1;var t=v('<div class="esa-catalog">                                     <div class="esa-catalog-tab"><h2>目录</h2></div>                                     <div class="esa-catalog-contents">                                         <div class="esa-catalog-title"><h2>目录</h2></div>                                         <a class="esa-catalog-close">X</a>                                     </div>                                 </div>'),l=0,o=0,r=0,c="<ul>";v.each(a,function(e,a){var t=v(a)[0].tagName.toLowerCase(),n="",s=v(a).text();if(i.index)t===i.level1?(r=o=0,n='<span class="level1">'+ ++l+". </span>"):t===i.level2?(r=0,n='<span class="level2">'+l+"."+ ++o+". </span>"):t===i.level3&&(n='<span class="level3">'+l+"."+o+"."+ ++r+". </span>");else switch(t){case i.level1:s='<span class="level1">'+s+"</span>";break;case i.level2:s='<span class="level2">'+s+"</span>";break;case i.level3:s='<span class="level3">'+s+"</span>"}c+='<li class="li_'+t+'" title="'+s+'"><i id="esa_index_'+e+'"></i><a class="esa-anchor-link">'+(n+s)+"</a></li>",v(a).attr("id","esa_index_"+e)}),c+="</ul>",t.find(".esa-catalog-contents").append(c),t.appendTo("body");if(v(".esa-anchor-link").on("click",function(){var e=v(this).prev("i").attr("id"),a=v("#"+e).offset().top-70;v("html, body").animate({scrollTop:a},300)}),v(".esa-catalog-tab").on("click",function(){v(this).hide(),v(".esa-catalog-contents").show()}),v(".esa-catalog-close").on("click",function(){v(".esa-catalog-contents").hide(),v(".esa-catalog-tab").show()}),i.move){var d={start:!1,pois:[0,0]};v(".esa-catalog-title").on("mousedown",function(e){e.preventDefault(),d.start=!0;var a=v(".esa-catalog").position(),t=e.clientX-parseFloat(a.left),n=e.clientY-parseFloat(a.top);d.pois=[t,n]}),v(document).on("mousemove",function(e){if(d.start){var a=e.clientX-d.pois[0],t=e.clientY-d.pois[1],n="fixed"===v(".esa-catalog").css("position");e.preventDefault(),d.stX=n?0:v(window).scrollLeft(),d.stY=n?0:v(window).scrollTop();var s=v(window).width()-v(".esa-catalog").outerWidth()+d.stX,i=v(window).height()-v(".esa-catalog").outerHeight()+d.stY;a<d.stX&&(a=d.stX),s<a&&(a=s),t<d.stY&&(t=d.stY),i<t&&(t=i),v(".esa-catalog").css({left:a,top:t,right:"auto"})}}).on("mouseup",function(e){d.start&&(d.start=!1)})}}}},{key:"version",get:function(){return"v1.0.8"}},{key:"cnblogs",get:function(){return{header:"#header",navigator:"#navigator",navList:"#navList",sideBar:"#sideBar",forFlow:".forFlow",postTitle:"#cb_post_title_url",postDetail:"#post_detail",postBody:"#cnblogs_post_body",postCommentBody:".blog_comment_body",feedbackContent:".feedbackCon",mySignature:"#MySignature",footer:"#footer"}}},{key:"isPostDetail",get:function(){return 0<v(this.cnblogs.postDetail).length}}]),e}()}(jQuery);