"use strict";var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(u){u.extend({silence:function(e){var t=new a;t.init(e)}});var a=function(){function e(){_classCallCheck(this,e),this.defaluts={catalog:{enable:!1,move:!0,index:!0,level1:"h2",level2:"h3",level3:"h4"},signature:{enable:!1,author:currentBlogApp||"--",home:"https://www.cnblogs.com",license:"署名 4.0 国际",link:"https://creativecommons.org/licenses/by/4.0"},reward:{enable:!1,title:null,wechat:null,alipay:null}}}return _createClass(e,[{key:"init",value:function(e){e&&u.extend(!0,this.defaluts,e),this.printVersion(),this.buildNavHoverEle(),this.buildMobileMenu(),this.buildCopyright(),this.isPostDetail?(this.goIntoReadingMode(),this.buildPostCatalog(),this.buildPostSignature(),this.buildPostReward(),this.buildPostCommentAvatar()):this.goIntoNormalMode()}},{key:"showMessage",value:function(e){u(".esa-layer").length||u("body").prepend('<div class="esa-layer"><span class="esa-layer-content"></span></div>'),u(".esa-layer-content").html(e),u(".esa-layer").fadeIn(250),setTimeout(function(){u(".esa-layer").fadeOut(500,function(){u(".esa-layer-content").empty()})},2500)}},{key:"printVersion",value:function(){console.log("%cSilence v"+this.version+" - https://github.com/esofar/cnblogs-theme-silence","color:red")}},{key:"goIntoReadingMode",value:function(){var e=this,t=u(window);767<t.width()&&t.scroll(function(){150<this.scrollY?u(e.cnblogs.header).slideUp():u(e.cnblogs.header).slideDown()})}},{key:"goIntoNormalMode",value:function(){767<u(window).width()&&(u(this.cnblogs.forFlow).css({marginLeft:"22em"}),u(this.cnblogs.sideBar).fadeIn(700))}},{key:"buildNavHoverEle",value:function(){var e=u(this.cnblogs.navList).find("li");u.each(e,function(e,t){u(t).append("<i></i>")})}},{key:"buildMobileMenu",value:function(){var e=this;u("body").prepend('<div class="esa-mobile-menu"></div>'),u(".esa-mobile-menu").on("click",function(){u(e.cnblogs.navigator).fadeToggle(200)})}},{key:"buildCopyright",value:function(){u(this.cnblogs.footer).append('<div>            Powered By             <a href="https://www.cnblogs.com" target="_blank">Cnblogs</a> |             <a href="https://github.com/esofar/cnblogs-theme-silence" target="_blank">Silence</a>             Theme By             <a href="https://www.cnblogs.com/esofar" target="_blank">Esofar</a></div>')}},{key:"buildPostSignature",value:function(){var e=this.defaluts.signature;if(e.enable){var t=u(this.cnblogs.postTitle).attr("href"),a='<div class="esa-post-signature">                                 <p>作者：<a href="'+e.home+'">'+e.author+'</a></p>                                 <p>出处：<a href="'+t+'">'+t+'</a></p>                                 <p>本站使用「<a href="'+(e.link||"#")+'"  target="_blank">'+e.license+"</a>」创作共享协议，转载请在文章明显位置注明作者及出处。</p>                                </div>";u(this.cnblogs.mySignature).html(a).show()}}},{key:"buildPostCommentAvatar",value:function(){var o=this,e=function(){u(o.cnblogs.postCommentBody).before("<div class='esa-comment-avatar'><a target='_blank'><img /></a></div>");for(var e=u(o.cnblogs.feedbackContent),t=0;t<e.length;t++){var a="https://pic.cnblogs.com/face/sample_face.gif",n=u(e[t]).find("span:last")[0];n&&(a=u(n).html().replace("http://","https://")),u(e[t]).find(".esa-comment-avatar img").attr("src",a);var s=u(e[t]).parent().find(".comment_date").next().attr("href");u(e[t]).find(".esa-comment-avatar a").attr("href",s)}};if(u(o.cnblogs.postCommentBody).length)e();else var t=1,a=setInterval(function(){u(o.cnblogs.postCommentBody).length&&(clearInterval(a),e()),5==t&&clearInterval(a),t++},1e3)}},{key:"buildPostReward",value:function(){var e=this.defaluts.reward;if(e.enable){if(!e.wechat&&!e.alipay)throw new Error("Reward module, both `wechat` and `alipay` are null.");var t='<div class="esa-reward">                         <div class="esa-reward-close">+</div>                         <h2>"'+(e.title||"")+'"</h2>                         <div class="esa-reward-container">';e.wechat&&(t+='<div class="wechat">                                         <img src="'+e.wechat+'" alt="微信支付">                                     </div>'),e.alipay&&(t+='<div class="alipay">                                         <img src="'+e.alipay+'" alt="支付宝支付">                                     </div>'),t+="</div></div>",u("body").append(t),u(".esa-reward-close").on("click",function(){u(".esa-reward").fadeOut()});var a=function(){u("#div_digg").prepend('<div class="reward"><span class="rewardnum" id="reward_count"></span></div>'),u("#div_digg .reward").on("click",function(){u(".esa-reward").fadeIn()})};if(u("#div_digg").length)a();else var n=setInterval(function(){u("#div_digg").length&&(clearInterval(n),a())},500)}else u("#div_digg").width(200)}},{key:"buildPostCatalog",value:function(){var o=this.defaluts.catalog;if(o.enable){var e=[o.level1,o.level2,o.level3],t=u(this.cnblogs.postBody).find(e.join(","));if(!t.length)return!1;var a=u('<div class="esa-catalog">                                     <div class="esa-catalog-tab"><h2>目录</h2></div>                                     <div class="esa-catalog-contents">                                         <div class="esa-catalog-title"><h2>目录</h2></div>                                         <a class="esa-catalog-close">X</a>                                     </div>                                 </div>'),i=0,l=0,r=0,c="<ul>";u.each(t,function(e,t){var a=u(t)[0].tagName.toLowerCase(),n="",s=u(t).text();if(o.index)a===o.level1?(r=l=0,n=++i+".&nbsp;"):a===o.level2?(r=0,n="&nbsp;&nbsp;"+i+"."+ ++l+".&nbsp;"):a===o.level3&&(n="&nbsp;&nbsp;&nbsp;&nbsp;"+i+"."+l+"."+ ++r+".&nbsp;");else switch(a){case o.level1:s=s;break;case o.level2:s="&nbsp;&nbsp;"+s;break;case o.level3:s="&nbsp;&nbsp;&nbsp;&nbsp;"+s}c+='<li class="li_'+a+'" title="'+s+'"><i id="esa_index_'+e+'"></i><a class="esa-anchor-link">'+(n+s)+"</a></li>",u(t).attr("id","esa_index_"+e)}),c+="</ul>",a.find(".esa-catalog-contents").append(c),a.appendTo("body");if(u(".esa-anchor-link").on("click",function(){var e=u(this).prev("i").attr("id"),t=u("#"+e).offset().top-70;u("html, body").animate({scrollTop:t},300)}),u(".esa-catalog-tab").on("click",function(){u(this).hide(),u(".esa-catalog-contents").show()}),u(".esa-catalog-close").on("click",function(){u(".esa-catalog-contents").hide(),u(".esa-catalog-tab").show()}),o.move){var d={start:!1,pois:[0,0]};u(".esa-catalog-title").on("mousedown",function(e){e.preventDefault(),d.start=!0;var t=u(".esa-catalog").position(),a=e.clientX-parseFloat(t.left),n=e.clientY-parseFloat(t.top);d.pois=[a,n]}),u(document).on("mousemove",function(e){if(d.start){var t=e.clientX-d.pois[0],a=e.clientY-d.pois[1],n="fixed"===u(".esa-catalog").css("position");e.preventDefault(),d.stX=n?0:u(window).scrollLeft(),d.stY=n?0:u(window).scrollTop();var s=u(window).width()-u(".esa-catalog").outerWidth()+d.stX,o=u(window).height()-u(".esa-catalog").outerHeight()+d.stY;t<d.stX&&(t=d.stX),s<t&&(t=s),a<d.stY&&(a=d.stY),o<a&&(a=o),u(".esa-catalog").css({left:t,top:a,right:"auto"})}}).on("mouseup",function(e){d.start&&(d.start=!1)})}}}},{key:"version",get:function(){return"1.0.7"}},{key:"cnblogs",get:function(){return{header:"#header",navigator:"#navigator",navList:"#navList",sideBar:"#sideBar",forFlow:".forFlow",postTitle:"#cb_post_title_url",postDetail:"#post_detail",postBody:"#cnblogs_post_body",postCommentBody:".blog_comment_body",feedbackContent:".feedbackCon",mySignature:"#MySignature",footer:"#footer"}}},{key:"isPostDetail",get:function(){return 0<u(this.cnblogs.postDetail).length}}]),e}()}(jQuery);